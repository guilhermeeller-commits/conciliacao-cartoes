<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard â€” Calisul</title>
    <meta name="description" content="Central Financeira Calisul â€” Dashboard de faturas de cartÃ£o de crÃ©dito">
    <link rel="stylesheet" href="/css/design-system.css">
    <script src="/js/theme-toggle.js"></script>
    <script src="/js/sidebar.js"></script>
    <script src="/js/notifications.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.7/dist/chart.umd.min.js"></script>
    <style>
        /* â”€â”€â”€ Dashboard Layout â”€â”€â”€ */
        .dashboard-grid {
            display: grid;
            gap: 24px;
        }

        /* â”€â”€â”€ Welcome Banner â”€â”€â”€ */
        .welcome-banner {
            background: linear-gradient(135deg, rgba(0, 94, 252, 0.08), rgba(99, 102, 241, 0.06));
            border: 1px solid rgba(0, 94, 252, 0.15);
            border-radius: var(--radius-lg);
            padding: 28px 32px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .welcome-banner h2 {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 6px;
        }

        .welcome-banner p {
            font-size: 13px;
            color: var(--text-secondary);
        }

        .welcome-sync {
            text-align: right;
            font-size: 11px;
            color: var(--text-muted);
        }

        .welcome-sync .sync-time {
            font-weight: 600;
            color: var(--text-secondary);
        }

        /* â”€â”€â”€ KPI accent bars â”€â”€â”€ */
        .kpi-card.accent-blue {
            border-top: 3px solid var(--blue);
        }

        .kpi-card.accent-green {
            border-top: 3px solid var(--green);
        }

        .kpi-card.accent-orange {
            border-top: 3px solid var(--orange);
        }

        .kpi-card.accent-purple {
            border-top: 3px solid #a855f7;
        }

        .kpi-value-row {
            display: flex;
            align-items: baseline;
            gap: 8px;
        }

        .kpi-pct {
            font-size: 12px;
            font-weight: 600;
            padding: 2px 6px;
            border-radius: 4px;
        }

        .kpi-pct.good {
            background: rgba(63, 185, 80, 0.12);
            color: var(--green);
        }

        .kpi-pct.warn {
            background: rgba(227, 179, 65, 0.12);
            color: var(--orange);
        }

        .kpi-pct.bad {
            background: rgba(248, 81, 73, 0.12);
            color: var(--red);
        }

        /* â”€â”€â”€ Charts â”€â”€â”€ */
        .charts-row {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 24px;
        }

        @media (max-width: 900px) {
            .charts-row {
                grid-template-columns: 1fr;
            }
        }

        .chart-card {
            background: var(--bg-card);
            border: 1px solid var(--border-default);
            border-radius: var(--radius-lg);
            padding: 24px;
        }

        .chart-card h3 {
            font-size: 14px;
            font-weight: 700;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .chart-container {
            position: relative;
            width: 100%;
        }

        .chart-container.bar-chart {
            height: 280px;
        }

        .chart-container.donut-chart {
            height: 280px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* â”€â”€â”€ Alerts â”€â”€â”€ */
        .alerts-section {
            background: var(--bg-card);
            border: 1px solid var(--border-default);
            border-radius: var(--radius-lg);
            padding: 24px;
        }

        .alerts-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .alerts-header h3 {
            font-size: 14px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .alert-badge {
            background: rgba(248, 81, 73, 0.12);
            color: var(--red);
            font-size: 11px;
            font-weight: 700;
            padding: 2px 8px;
            border-radius: 10px;
        }

        .alert-item {
            display: flex;
            align-items: center;
            gap: 14px;
            padding: 12px 14px;
            border-radius: var(--radius-md);
            transition: background var(--transition-fast);
            cursor: pointer;
            text-decoration: none;
            color: inherit;
        }

        .alert-item:hover {
            background: var(--bg-hover);
        }

        .alert-item+.alert-item {
            border-top: 1px solid var(--border-muted);
        }

        .alert-icon {
            width: 36px;
            height: 36px;
            border-radius: var(--radius-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            flex-shrink: 0;
            background: rgba(248, 81, 73, 0.08);
        }

        .alert-info {
            flex: 1;
            min-width: 0;
        }

        .alert-info h4 {
            font-size: 13px;
            font-weight: 600;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .alert-info p {
            font-size: 11px;
            color: var(--text-muted);
            margin-top: 2px;
        }

        .alert-action {
            font-size: 12px;
            color: var(--blue);
            font-weight: 600;
            white-space: nowrap;
        }

        /* â”€â”€â”€ Bottom Grid â”€â”€â”€ */
        .bottom-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
        }

        @media (max-width: 800px) {
            .bottom-grid {
                grid-template-columns: 1fr;
            }
        }

        .section-card {
            background: var(--bg-card);
            border: 1px solid var(--border-default);
            border-radius: var(--radius-lg);
            padding: 24px;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .section-header h3 {
            font-size: 14px;
            font-weight: 700;
        }

        /* â”€â”€â”€ Recent items â”€â”€â”€ */
        .recent-item {
            display: flex;
            align-items: center;
            gap: 14px;
            padding: 12px 14px;
            border-radius: var(--radius-md);
            transition: background var(--transition-fast);
            cursor: pointer;
            text-decoration: none;
            color: inherit;
        }

        .recent-item:hover {
            background: var(--bg-hover);
        }

        .recent-item+.recent-item {
            border-top: 1px solid var(--border-muted);
        }

        .recent-icon {
            width: 36px;
            height: 36px;
            border-radius: var(--radius-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            flex-shrink: 0;
            background: rgba(0, 94, 252, 0.08);
        }

        .recent-info {
            flex: 1;
            min-width: 0;
        }

        .recent-info h4 {
            font-size: 13px;
            font-weight: 600;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .recent-info p {
            font-size: 11px;
            color: var(--text-muted);
            margin-top: 2px;
        }

        .recent-meta {
            text-align: right;
        }

        .recent-meta .date {
            font-size: 12px;
            color: var(--text-secondary);
        }

        /* â”€â”€â”€ Progress mini bar â”€â”€â”€ */
        .progress-mini {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 4px;
        }

        .progress-mini .bar {
            width: 60px;
            height: 4px;
            background: var(--border-muted);
            border-radius: 2px;
            overflow: hidden;
        }

        .progress-mini .bar .fill {
            height: 100%;
            background: var(--green);
            border-radius: 2px;
        }

        .progress-mini .label {
            font-size: 11px;
            color: var(--text-muted);
        }

        /* â”€â”€â”€ Card progress â”€â”€â”€ */
        .card-progress-item {
            display: flex;
            align-items: center;
            gap: 14px;
            padding: 12px 14px;
            border-radius: var(--radius-md);
        }

        .card-progress-item+.card-progress-item {
            border-top: 1px solid var(--border-muted);
        }

        .card-progress-icon {
            width: 36px;
            height: 36px;
            border-radius: var(--radius-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            flex-shrink: 0;
            background: rgba(99, 102, 241, 0.08);
        }

        .card-progress-info {
            flex: 1;
        }

        .card-progress-info h4 {
            font-size: 13px;
            font-weight: 600;
        }

        .card-progress-info p {
            font-size: 11px;
            color: var(--text-muted);
            margin-top: 2px;
        }

        .card-progress-pct {
            font-size: 16px;
            font-weight: 700;
            text-align: right;
        }

        .card-progress-bar {
            width: 80px;
            height: 4px;
            background: var(--border-muted);
            border-radius: 2px;
            overflow: hidden;
            margin-top: 4px;
        }

        .card-progress-bar .fill {
            height: 100%;
            background: var(--green);
            border-radius: 2px;
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-muted);
            font-size: 13px;
        }

        .no-alerts {
            padding: 24px;
            text-align: center;
            color: var(--text-muted);
            font-size: 13px;
        }

        .no-alerts .icon {
            font-size: 32px;
            margin-bottom: 8px;
        }
    </style>
</head>

<body>
    <div class="erp-layout">
        <!-- Sidebar injected by sidebar.js -->

        <!-- Main -->
        <main class="erp-main">
            <button class="mobile-toggle" id="mobileToggle" aria-label="Menu">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                    stroke-linecap="round" stroke-linejoin="round">
                    <line x1="3" y1="12" x2="21" y2="12" />
                    <line x1="3" y1="6" x2="21" y2="6" />
                    <line x1="3" y1="18" x2="21" y2="18" />
                </svg>
            </button>

            <!-- Breadcrumb -->
            <div class="erp-breadcrumb">
                <span class="current">dashboard</span>
            </div>

            <div class="erp-content">
                <div class="dashboard-grid">

                    <!-- Welcome Banner -->
                    <div class="welcome-banner">
                        <div>
                            <h2>Central Financeira â€” CartÃµes</h2>
                            <p>VisÃ£o geral dos extratos e conciliaÃ§Ãµes de cartÃ£o de crÃ©dito</p>
                        </div>
                        <div class="welcome-sync" id="syncInfo"></div>
                    </div>

                    <!-- KPIs -->
                    <div class="kpi-grid" id="kpiGrid">
                        <div class="kpi-card accent-blue">
                            <div class="kpi-label">Faturas importadas</div>
                            <div class="kpi-value" id="kpiFaturas">â€”</div>
                            <div class="kpi-sub" id="kpiFaturasSub">carregando...</div>
                        </div>
                        <div class="kpi-card accent-green">
                            <div class="kpi-label">TransaÃ§Ãµes categorizadas</div>
                            <div class="kpi-value-row">
                                <span class="kpi-value" id="kpiCategorizadas">â€”</span>
                                <span class="kpi-pct" id="kpiCategorizadasPct"></span>
                            </div>
                            <div class="kpi-sub" id="kpiCategorizadasSub"></div>
                        </div>
                        <div class="kpi-card accent-orange">
                            <div class="kpi-label">TransaÃ§Ãµes pendentes</div>
                            <div class="kpi-value" id="kpiPendentes">â€”</div>
                            <div class="kpi-sub" id="kpiPendentesSub"></div>
                        </div>
                        <div class="kpi-card accent-purple">
                            <div class="kpi-label">Valor total</div>
                            <div class="kpi-value" id="kpiValor">â€”</div>
                            <div class="kpi-sub" id="kpiValorSub"></div>
                        </div>
                    </div>

                    <!-- Alerts -->
                    <div class="alerts-section" id="alertsSection">
                        <div class="alerts-header">
                            <h3>
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path
                                        d="M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z" />
                                    <line x1="12" y1="9" x2="12" y2="13" />
                                    <line x1="12" y1="17" x2="12.01" y2="17" />
                                </svg>
                                AtenÃ§Ã£o necessÃ¡ria
                                <span class="alert-badge" id="alertCount">0</span>
                            </h3>
                            <a href="/faturas.html?status=pending" class="btn btn-outline btn-sm">Ver todas</a>
                        </div>
                        <div id="alertsList"></div>
                    </div>

                    <!-- Charts -->
                    <div class="charts-row">
                        <div class="chart-card">
                            <h3>ğŸ“Š Gastos por Categoria (Ãºltimos 6 meses)</h3>
                            <div class="chart-container bar-chart">
                                <canvas id="chartMonthly"></canvas>
                            </div>
                        </div>
                        <div class="chart-card">
                            <h3>ğŸ’³ DistribuiÃ§Ã£o por CartÃ£o</h3>
                            <div class="chart-container donut-chart">
                                <canvas id="chartDonut"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- Bottom: Recent + Card Progress -->
                    <div class="bottom-grid">
                        <div class="section-card">
                            <div class="section-header">
                                <h3>ğŸ“‹ Ãšltimas faturas importadas</h3>
                                <a href="/faturas.html" class="btn btn-outline btn-sm">Ver todas</a>
                            </div>
                            <div id="recentList">
                                <div class="empty-state">Carregando...</div>
                            </div>
                        </div>
                        <div class="section-card">
                            <div class="section-header">
                                <h3>ğŸ”„ Progresso por cartÃ£o</h3>
                                <a href="/faturas.html" class="btn btn-outline btn-sm">Ver faturas</a>
                            </div>
                            <div id="cardProgress">
                                <div class="empty-state">Carregando...</div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </main>
    </div>

    <script>
        // â”€â”€â”€ Chart.js Config â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        const CHART_COLORS = [
            '#005efc', '#3fb950', '#e3b341', '#f85149',
            '#a855f7', '#06b6d4', '#f97316', '#ec4899',
        ];

        // â”€â”€â”€ Init â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        document.addEventListener('DOMContentLoaded', loadDashboard);

        async function loadDashboard() {
            try {
                const res = await fetch('/api/dashboard/stats');
                const data = await res.json();

                renderKPIs(data.kpis);
                renderAlerts(data.alerts);
                renderChartMonthly(data.charts.monthly);
                renderChartDonut(data.charts.byCard);
                renderRecent(data.recent);
                renderCardProgress(data.cardProgress);
                renderSyncInfo(data.kpis.last_olist_sync);
            } catch (e) {
                console.error('Erro ao carregar dashboard:', e);
            }
        }

        // â”€â”€â”€ KPIs â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        function renderKPIs(kpis) {
            document.getElementById('kpiFaturas').textContent = kpis.total_statements;
            document.getElementById('kpiFaturasSub').textContent =
                kpis.total_statements === 0
                    ? 'nenhuma fatura'
                    : `de ${kpis.distinct_cards} cartÃµes`;

            document.getElementById('kpiCategorizadas').textContent =
                kpis.total_categorized.toLocaleString('pt-BR');

            const pctEl = document.getElementById('kpiCategorizadasPct');
            pctEl.textContent = `${kpis.pct_categorized}%`;
            pctEl.className = 'kpi-pct ' +
                (kpis.pct_categorized >= 80 ? 'good' : kpis.pct_categorized >= 50 ? 'warn' : 'bad');

            document.getElementById('kpiCategorizadasSub').textContent =
                `de ${kpis.total_transactions.toLocaleString('pt-BR')} transaÃ§Ãµes`;

            document.getElementById('kpiPendentes').textContent =
                kpis.total_pending.toLocaleString('pt-BR');
            document.getElementById('kpiPendentesSub').textContent =
                kpis.total_pending === 0 ? 'tudo categorizado! ğŸ‰' : 'aguardando classificaÃ§Ã£o';

            document.getElementById('kpiValor').textContent =
                `R$ ${kpis.total_amount.toLocaleString('pt-BR', { minimumFractionDigits: 2 })}`;
            document.getElementById('kpiValorSub').textContent = 'soma de todas as faturas';
        }

        // â”€â”€â”€ Sync Info â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        function renderSyncInfo(lastSync) {
            const el = document.getElementById('syncInfo');
            if (!lastSync) {
                el.innerHTML = '<span>Olist: <span class="sync-time">nunca sincronizado</span></span>';
                return;
            }
            const date = new Date(lastSync);
            const formatted = date.toLocaleDateString('pt-BR') + ' ' + date.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });
            el.innerHTML = `<span>Ãšltima sync Olist:<br><span class="sync-time">${formatted}</span></span>`;
        }

        // â”€â”€â”€ Alerts â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        function renderAlerts(alerts) {
            const container = document.getElementById('alertsList');
            const badge = document.getElementById('alertCount');

            if (!alerts || alerts.length === 0) {
                badge.textContent = '0';
                container.innerHTML = `
                    <div class="no-alerts">
                        <div class="icon">âœ…</div>
                        <p>Nenhuma fatura pendente de categorizaÃ§Ã£o</p>
                    </div>`;
                return;
            }

            badge.textContent = alerts.length;

            container.innerHTML = alerts.map(a => {
                const pct = a.total_transactions > 0
                    ? Math.round((a.categorized_count / a.total_transactions) * 100)
                    : 0;
                return `
                    <a class="alert-item" href="/extrato-detalhe.html?id=${a.id}">
                        <div class="alert-icon">âš ï¸</div>
                        <div class="alert-info">
                            <h4>${escapeHtml(a.filename)}</h4>
                            <p>${a.pending_count} transaÃ§Ãµes sem categoria Â· ${pct}% categorizado</p>
                        </div>
                        <div class="alert-action">Categorizar â†’</div>
                    </a>`;
            }).join('');
        }

        // â”€â”€â”€ Chart: Monthly by Category â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        function renderChartMonthly(monthly) {
            const ctx = document.getElementById('chartMonthly');
            if (!monthly || !monthly.labels || monthly.labels.length === 0) {
                ctx.parentElement.innerHTML = '<div class="empty-state">Sem dados de transaÃ§Ãµes categorizadas para o grÃ¡fico</div>';
                return;
            }

            const isDark = document.documentElement.getAttribute('data-theme') !== 'light';
            const gridColor = isDark ? 'rgba(255,255,255,0.06)' : 'rgba(0,0,0,0.08)';
            const textColor = isDark ? '#8b949e' : '#656d76';

            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: monthly.labels,
                    datasets: monthly.datasets.map((ds, i) => ({
                        label: ds.label,
                        data: ds.data,
                        backgroundColor: CHART_COLORS[i % CHART_COLORS.length] + 'cc',
                        borderRadius: 3,
                        borderSkipped: false,
                    })),
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                color: textColor,
                                font: { size: 11 },
                                boxWidth: 12,
                                padding: 12,
                            },
                        },
                        tooltip: {
                            callbacks: {
                                label: (ctx) => `${ctx.dataset.label}: R$ ${ctx.raw.toLocaleString('pt-BR', { minimumFractionDigits: 2 })}`,
                            },
                        },
                    },
                    scales: {
                        x: {
                            stacked: true,
                            grid: { display: false },
                            ticks: { color: textColor, font: { size: 11 } },
                        },
                        y: {
                            stacked: true,
                            grid: { color: gridColor },
                            ticks: {
                                color: textColor,
                                font: { size: 11 },
                                callback: (v) => `R$ ${(v / 1000).toFixed(0)}k`,
                            },
                        },
                    },
                },
            });
        }

        // â”€â”€â”€ Chart: Donut by Card â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        function renderChartDonut(byCard) {
            const ctx = document.getElementById('chartDonut');
            if (!byCard || !byCard.labels || byCard.labels.length === 0) {
                ctx.parentElement.innerHTML = '<div class="empty-state">Sem dados para o grÃ¡fico</div>';
                return;
            }

            const isDark = document.documentElement.getAttribute('data-theme') !== 'light';
            const textColor = isDark ? '#8b949e' : '#656d76';

            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: byCard.labels,
                    datasets: [{
                        data: byCard.data,
                        backgroundColor: CHART_COLORS.slice(0, byCard.labels.length),
                        borderWidth: 0,
                        hoverOffset: 6,
                    }],
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '65%',
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                color: textColor,
                                font: { size: 11 },
                                boxWidth: 12,
                                padding: 12,
                            },
                        },
                        tooltip: {
                            callbacks: {
                                label: (ctx) => {
                                    const total = ctx.dataset.data.reduce((s, v) => s + v, 0);
                                    const pct = total > 0 ? Math.round((ctx.raw / total) * 100) : 0;
                                    return `${ctx.label}: R$ ${ctx.raw.toLocaleString('pt-BR', { minimumFractionDigits: 2 })} (${pct}%)`;
                                },
                            },
                        },
                    },
                },
            });
        }

        // â”€â”€â”€ Recent â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        function renderRecent(recent) {
            const container = document.getElementById('recentList');

            if (!recent || recent.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <p>Nenhuma fatura importada ainda</p>
                        <a href="/faturas.html" class="btn btn-blue btn-sm">Importar primeira fatura</a>
                    </div>`;
                return;
            }

            container.innerHTML = recent.map(s => {
                const date = formatDate(s.statement_date);
                const pct = s.total_transactions > 0
                    ? Math.round((s.categorized_count / s.total_transactions) * 100) : 0;
                return `
                    <a class="recent-item" href="/extrato-detalhe.html?id=${s.id}">
                        <div class="recent-icon">ğŸ’³</div>
                        <div class="recent-info">
                            <h4>${escapeHtml(s.filename)}</h4>
                            <p>${escapeHtml(s.card_name || 'â€”')} Â· ${escapeHtml(s.financial_account || 'â€”')}</p>
                        </div>
                        <div class="recent-meta">
                            <div class="date">${date}</div>
                            <div class="progress-mini">
                                <div class="bar"><div class="fill" style="width: ${pct}%"></div></div>
                                <span class="label">${s.categorized_count}/${s.total_transactions}</span>
                            </div>
                        </div>
                    </a>`;
            }).join('');
        }

        // â”€â”€â”€ Card Progress â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        function renderCardProgress(progress) {
            const container = document.getElementById('cardProgress');

            if (!progress || progress.length === 0) {
                container.innerHTML = '<div class="empty-state">Nenhum dado disponÃ­vel</div>';
                return;
            }

            container.innerHTML = progress.map(c => {
                const pct = c.total_tx > 0 ? Math.round((c.categorized_tx / c.total_tx) * 100) : 0;
                const pctColor = pct === 100 ? 'var(--green)' : 'var(--text-primary)';
                return `
                    <div class="card-progress-item">
                        <div class="card-progress-icon">ğŸ’³</div>
                        <div class="card-progress-info">
                            <h4>${escapeHtml(c.card_name)}</h4>
                            <p>${c.statement_count} fatura${c.statement_count !== 1 ? 's' : ''} Â· R$ ${c.total_amount.toLocaleString('pt-BR', { minimumFractionDigits: 2 })}</p>
                        </div>
                        <div style="text-align: right;">
                            <div class="card-progress-pct" style="color: ${pctColor}">${pct}%</div>
                            <div class="card-progress-bar"><div class="fill" style="width: ${pct}%"></div></div>
                        </div>
                    </div>`;
            }).join('');
        }

        // â”€â”€â”€ Helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        function formatDate(dateStr) {
            if (!dateStr) return 'â€”';
            const parts = dateStr.split('-');
            if (parts.length === 3) return `${parts[2]}/${parts[1]}/${parts[0]}`;
            return dateStr;
        }

        function escapeHtml(str) {
            if (!str) return '';
            const div = document.createElement('div');
            div.textContent = str;
            return div.innerHTML;
        }
    </script>
</body>

</html>